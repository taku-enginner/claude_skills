# Video Keyframe Extraction Skill

動画をClaude Codeに安く渡すためのスキルです。

## 概要

通常、動画をフレーム分割して全部渡すと、5秒の動画で約450円かかります。
このスキルは以下の最適化で、コストを**約1/19**に削減します：

- **差分が大きいキーフレームのみを抽出**: 類似度閾値で重複フレームを除外
- **画質を下げる**: JPEG品質を30に設定
- **サイズを縮小**: 0.3倍にリサイズ

### 削減例
| 項目 | 変更前 | 変更後 |
|------|--------|--------|
| フレーム数 | 71枚 | 52枚 |
| サイズ | 443×960 | 266×576 px |
| 容量 | 2.40MB | 0.54MB |
| コスト | 約450円 | **約24円** |

## インストール

```bash
pip install -r requirements.txt
```

## 使い方

### 基本的な使い方

```bash
python extract_keyframes.py video.mp4
```

### オプション付き

```bash
python extract_keyframes.py video.mp4 -o keyframes -t 0.85 -q 30 -s 0.3
```

### オプション

| オプション | 説明 | デフォルト |
|------------|------|------------|
| `-o, --output` | 出力ディレクトリ | keyframes |
| `-t, --threshold` | 類似度閾値 (0.0-1.0) | 0.85 |
| `-q, --quality` | JPEG品質 (1-100) | 30 |
| `-s, --scale` | リサイズ倍率 (0.0-1.0) | 0.3 |
| `-m, --max-frames` | 最大抽出フレーム数 | 100 |

### 設定の目安

- **類似度閾値 (-t)**: 0.85-0.95（低いほど多くのフレームを抽出）
- **JPEG品質 (-q)**: 20-50（低いほど圧縮率が高い）
- **スケール (-s)**: 0.2-0.5（低いほど小さいサイズ）

## 活用例

### 画面遷移のバグ修正

画面録画した動画からキーフレームを抽出し、Claude Codeに渡すことで：
- 画面遷移のバグを特定
- UIの問題点を分析
- 修正案を提案

```bash
# 画面録画を処理
python extract_keyframes.py screen_recording.mp4 -o frames -t 0.80

# 抽出されたフレームをClaude Codeに渡す
# Claude Code内でframesディレクトリの画像を読み込む
```

## 仕組み

1. **フレーム抽出**: OpenCVで動画から全フレームを取得
2. **類似度計算**: ヒストグラム比較で連続フレーム間の類似度を計算
3. **キーフレーム選択**: 類似度が閾値より低いフレームを抽出
4. **圧縮**: リサイズ + JPEG圧縮でファイルサイズを削減

## トークン計算

Claude Visionは約750ピクセルあたり1トークンを使用します。

例: 266×576 px のフレーム
- ピクセル数: 153,216 px
- トークン数: 約199トークン/枚
- 52枚の場合: 約10,400トークン
- Claude Opus料金: $15/1M → 約$0.16 (約24円)

## ライセンス

MIT License
